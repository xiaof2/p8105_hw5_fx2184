---
title: "p8105_hw5_fx2184"
author: "Fei"
date: "2022-11-15"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(readr)
library(rvest)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

# problem 2
```{r, meassage = FALSE}
# read the data from the web 
url = "https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv"

homicides_raw = read_csv(url)
```
* The raw dataset include `r nrow(homicides_raw)`observations of homicides reported criminal homicides over the past decade in 50 of the largest American cities, and `r ncol(homicides_raw)` key variables, they are `r homicides_raw %>% names`. 
* some reported `unknown` under variable victim age, sex and race. 
* the `lat` contains `r sum(is.na(homicides_raw$lat))` missing value, and `lon` contains `r sum(is.na(homicides_raw$lon))` missing value, 
* the raw data contains 3 numeric variables: reported data. longitude and latitude, rest of the variables are designed as character variables. 
* The data contains only one observation from `Tulsa` with state `OK`, which does not make sense. So I assume it's a typo, I will delete this row in the further cleaning step. 


```{r}
#clean the raw data and create city_state and resolved
homicides = homicides_raw %>% 
  janitor::clean_names() %>% 
  mutate(city_state = str_c(city, state,sep = ", "),
         resolved = case_when(
           disposition == "Closed by arrest" ~ "solved",
           disposition ==  "Open/No arrest" ~ "unsolved",
           disposition ==  "Closed without arrest" ~ "unsolved"
         )) %>% 
  filter(city_state != "Tulsa, AL") %>% 
  relocate(uid, city_state)
```

```{r}
#summarize within cities to obtain the total number of homicides and the number of unsolved homicides
total_homicides = homicides %>% 
  group_by(city_state) %>% 
  summarize(total_homicide = n(), unsolved = sum(resolved == "unsolved")) 

total_homicides %>% knitr::kable(align='c',col.names = c("City/State","Total Number of Homicids","Number of Unsolved "))
```


```{r}
# For the city of Baltimore, MD,estimate the proportion of homicides that are unsolved
prop_baltimore =  prop.test(total_homicides %>% filter(city_state == "Baltimore, MD") %>% pull(unsolved),
                            total_homicides %>% filter(city_state == "Baltimore, MD") %>% pull(total_homicide))
broom::tidy(prop_baltimore)
```


